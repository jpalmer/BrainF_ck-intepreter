;The aim of this is to create a brainfuck intepreter
;status - trying for speed increases 
extern printf
extern malloc
extern putchar
;due to different calling convention, the registers that we use depend on the OS
%ifdef WIN64
	%define vd rcx
    %define main WinMain ;on windows main is not called main
%endif
%ifdef LIN64
    %define vd rdi
%endif
global main

;x64 calling convention
;ints / pointers - RCX RDX R8 R9
; - rdi is first on linux
; initialized data is put in the .data segment - it may be true that these are not modifiable
segment .data
debug db "dd",0
intf db "%i" ,10,0
charf db "%c",0
hellostr db "loop", 10 ,0
incdp db ">"
decdp db "<"
incbyte db "+"
decbyte db "-"
output db "."
input db ","
whilestart db "["
whileend db "]"
array dq 0
jtab dq 0 ;stored in r9
plength dq 0

segment .text
main:
	push   rbp
   	mov    rbp,rsp
%ifdef WIN64 ;not sure precisely what this does, got it by doing an objdump of a c exe - consider it magic
   	sub    rsp,0x20
%elifdef LIN64
    sub rsp,0x10
%endif
    ;allocate memory for memory
	mov vd,  0x5000000
	call malloc	
    mov rbx, rax
	mov vd, [rbx]
